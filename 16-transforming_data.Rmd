# Transforming Data {#transforming-data}

```{r, include = FALSE, echo = FALSE, child = "R/before_chunk.Rmd"}
```

```{r, echo = FALSE, out.width = '70%', fig.link = 'https://github.com/allisonhorst/stats-illustrations', fig.cap = "Artwork by Allison Horst contributed to Hadley Wickham's talk \"The Joy of Functional Programming (for Data Science).\""}

knitr::include_graphics("https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/data_cowboy.png")

```

## Overview

```{r, echo = FALSE, results = 'asis'}

insert_intro(goal = "To teach students how to transform raw tabular data to make it suitable for statistical analysis.",
             tldr = "Wrangling data is challenging in any context, but at least it's reproducible in R.",
             outcomes = c("arranging data.frames by ordering along one or more variables or columns,",
                          "subsetting data.frames by filtering rows and selecting columns,", 
                          "transforming data.frames by adding or changing variable or column values,",
                          "summarizing data.frames by aggregating factor variables, and",
                          "combining data.frames by binding rows and/or columns."),
             datasets = list(c(name = "Palmer Penguins",
                               url = "https://allisonhorst.github.io/palmerpenguins/",
                               ref = "[@horst2020palmer]")),
             requirements = list(),
             readings = list()
)

```

For this, we'll use our penguins data.

```{r, render = function(x, ...){ print(x) }}

penguins <- read.csv("penguins.csv")

str(penguins)

```

## Order  

Suppose we want to re-arrange the rows of our penguins by sorting them in terms of body mass. Ideally, base R would provide us a function that takes a data.frame as input, along with a specification of which variable or variables should be used to re-order rows, and return the re-ordered data.frame as output. Unfortunately, that does not exist, not in base R anyway. So, ordering a data.frame requires some finagling. Specifically, you need to create an _index vector_ of the re-ordered rows and apply that to the data.frame. To create such a vector, we use the `order()` function. 

```{r, render = function(x, options) { print(x) }}

# create index vector
row_i <- order(penguins$body_mass_g)

row_i[1:5]

order_penguins <- penguins[row_i, ]

head(order_penguins)

```

Note, that you can order by increasing values of the variable (`decreasing = FALSE`) or decreasing values of the variable (`increasing = TRUE`). 

```{r, render = function(x, options) { print(x) }}

row_i <- order(penguins$body_mass_g, decreasing = TRUE)

order_penguins <- penguins[row_i, ]

head(order_penguins)

```


### Changing variables  


```{r}

new_penguins <- transform(penguins, 
                          body_mass_g = scale(body_mass_g))

```

```{r}

new_penguins <- transform(penguins, 
                          body_mass_g = scale(body_mass_g),
                          bill_length_mm = scale(bill_length_mm),
                          flipper_length_mm = scale(flipper_length_mm))

```


### Adding variables


```{r}

new_penguins <- transform(penguins, 
                          body_mass_zs = scale(body_mass_g))

setdiff(names(new_penguins), names(penguins))

```

```{r}

new_penguins$body_mass_zs <- scale(penguins$body_mass_g)

new_penguins[ , "body_mass_zs"] <- scale(penguins$body_mass_g)

```


### Combine  

```{r, eval = FALSE}

all_penguins <- rbind(penguins, new_penguins)

penguins <- cbind(penguins, new_variables)

```

You can also add new variables with `cbind()`.

```{r, eval = FALSE}

new_penguins <- cbind(penguins, "body_mass_z" = scale(penguins$body_mass_g))

```






