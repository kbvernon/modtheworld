# (PART) Introduction to R {-}

# What is R? {#what-is-r}

```{r r-foot, echo = FALSE, out.width = '100%', fig.link = 'https://en.wikipedia.org/wiki/Patterson%E2%80%93Gimlin_film'}

knitr::include_graphics("images/r-foot.jpg")

```

<br>

## Overview

```{r, echo = FALSE, results = 'asis'}

insert_intro(goal = "To provide a brief overview of R and what one can do with it.",
             tldr = "R is a functional programming language and environment for statistical analysis.",
             outcomes = c("what R is,",
                          "why you should use it, and",
                          "what a stereotypical workflow with it looks like."),
             datasets = list(c(name = "Palmer Penguins", 
                               url = "https://allisonhorst.github.io/palmerpenguins/",
                               ref = "[@horst2020palmer]")),
             requirements = list(),
             readings = list(c(name = "An Introduction to R",
                               url = "https://cran.r-project.org/doc/manuals/r-release/R-intro.html",
                               ref = "[@rcoreteam2020introduction]"),
                             c(name = "R FAQ",
                               url = "https://CRAN.R-project.org/doc/FAQ/R-FAQ.html",
                               ref = "[@hornik2020faq]")))

```

<br>

## What R?

R is variously described as a programming *language* for statistical computing and as a programming *environment* [@hornik2020faq]. In fact, if you use R to conduct any statistical analysis that will likely end up in a scientific publication, you will want to refer to it as such -- to say something like "All analyses were conducted in the R Programming Environment" or "All analyses were conducted with the R Programming Language" -- and then to cite it! For example,

> Statistical analysis was performed in `r gsub("\\s*\\([^\\)]+\\)", replacement = "", sessionInfo()$R.version$version.string)` [@rcoreteam2020language].

And the full citation you can now see in the References below.

### The R Environment

According to the R Core Team [-@rcoreteam2020introduction], referring to R as an environment "is intended to characterize it as a fully planned and coherent system, rather than an incremental accretion of very specific and inflexible tools." Now, on its face, this is a somewhat strange claim, as the word 'environment' would seem to suggest a physical surrounding composed of *unplanned* and *incremental* accretions. What is more, the R Programming Environment is not immune, as the quote would suggest, to constraints imposed by its history and evolution. Nowhere is this more apparent than in the myriad syntactic inconsistencies that have proliferated over the last 25 years of R's development [@Wickham2015advanced].

Still, the word 'environment' is a good one, for R really is an environment that one can *enter into*, so to speak, and there do lots of very fun, very interesting, and very meaningful things, like complex data manipulations, fancy statistics, and data visualization (see [The Whole Shebang](#example) for an example workflow!). In this sense, you can think of it as a literal terminal or console on your computer that you type commands into (though, technically, that's just an *interface* to the R environment). Here is what the raw R console that ships with the base installation looks like, in all its horrifying, late-nineties beauty:

<br>

```{r r-console, echo = FALSE, out.width = '70%'}

knitr::include_graphics("images/r-console.png")

```

<br>

You will almost never work in this raw console, instead utilizing a cleaner, more modern, and user-friendly IDE (or Integrated Development Environment) like RStudio, but more on that later.

### The R Language

R is also a functional programming *language* [@hornik2020faq] in the sense that it has a well-defined syntax and semantics, which together define rules for combining symbols into complex strings and interpreting their meaning. This is partially what they meant, I think, when the R Foundation described R as a "coherent system." It is a coherent set of *rules* that govern the writing of code and its execution. I mean, you can't just type *anything* into the R console and expect to get a result. For example,

```{r, error = TRUE}
1lakj-5

```

is just gibberish and as you see, R protests. But

```{r}

mean(1:5)

```

is not. This string of symbols is simply requesting the mean of the numbers 1 through 5. R understands this and thus returns the desired output.

__In sum, you write the R language into the R environment, where it gets interpreted and returns some result.__

## Why R?

Actually, 'R' is a play on 'S', the name of the language R is based on, which John Chambers developed at Bell Labs in 1976. 'R' is also a reference to its authors, Ross Ihaka and Robert Gentleman, who began working on R at the University of Auckland in New Zealand, releasing it piecemeal into the digital wilds starting in 1993 [@hornik2020faq].

But, maybe you want to know why you should *use* R. Well...

### It's Free!

R is free software under the terms of the [Free Software Foundation's](http://www.gnu.org/) GNU General Public License.

### It's Statistics Made Easy, or Easier

Using R lets you exploit the awesome computing powers of the modern world. Just try, for example, to do maximum likelihood estimation on, say, 10,000 observations of a half-dozen variables by hand. It is *NOT* worth it. But it is with R! And, what is more, R provides an elegant and concise syntax for writing these complex statistical operations.

```{r, eval = FALSE}

# fit a generalized linear model with a Gaussian error distribution to the data
glm(formula = y ~ x1 + x2 + x3 + x4 + x5, 
    family  = gaussian,
    data    = my_ten_thousand_observations)

```

### It's Pretty Figures

One of the most powerful features of R is its ability to produce publication-quality plots. R's native graphics engine allows you to, for example, plot this pretty normal distribution:

```{r, echo = FALSE, fig.width = 5, fig.height = 5.2}

x <- seq(from = -5, 
         to = 5, 
         length = 100)

y <- dnorm(x)

windowsFonts(A = windowsFont("Arial"))

par(family = "A")

plot(y ~ x, 
     type = "l",
     xlab = "X",
     ylab = "Y")

grid(lty = 1)

box()

dark_red <- rgb(red = 0.52, 
                green = 0, 
                blue = 0)

dark_red_transparent <- rgb(red = 0.52, 
                           green = 0, 
                           blue = 0, 
                           alpha = 0.35)

polygon(x, y, 
        border = NA,
        col = dark_red_transparent)

lines(x, y, col = dark_red)

mtext(text = "A Pretty Gaussian!",
      side = 3, 
      line = 0.3, 
      adj = 0, 
      cex = 1.5)

```

### It's Reproducible

R also facilitates reproducible research. It does this in two ways. First, it forces you to declare explicitly each step in your analysis.

```{r, eval = FALSE}

set.seed(12345)

my_data <- sample(1:1000, size = 100)

mu <- mean(my_data)

std_dev <- sd(my_data)

```

We see here that someone has set the seed for R's random number generator, sampled one hundred numbers between 1 and 1000, then taken the mean of that sample and its standard deviation. Everyone can now see this process and repeat it verbatim for themselves. Crucially, *everyone* also includes future-you, that stranger who might one day look back and wonder, "How did I do this?"

The second way that R promotes reproducible research is by making R code like this *shareable*. In the simplest case, we use R *scripts*, which are text-based files with a '.R' file extension. With an R script, you can write all your R code as plain text, which you or someone else can then pass to the console, one line at a time, or all at once. Alternatively, we can use [R Markdown](), a much more flexible tool for not only writing and saving R code, but for documenting it.

### It's an Active Community

R is also an incredibly active and growing community, with lots of rich and informative documentation, and forums where one can go to get help trouble-shooting problems. There are a lot of ways to visualize this idea, but here is one, the number of downloads of R from the online RStudio CRAN mirror (not necessary to know what that is) from 2015 to the present.

```{r r-downloads, echo = FALSE, fig.width = 5, fig.height = 4}

load("r-downloads.Rda")

ggplot(bob, aes(x = month, y = count)) +
  geom_line(color = dark_red) +
  theme_bw() +
  labs(title = "R Downloads From RStudio CRAN Mirror")

```

## Some R Basics

### A Glorified Calculator?

### Console v Scripts

## The Whole Shebang {#example}

To give you a feel for what all can be done with R, let's walk through an example workflow (see Fig. \@ref(fig:r-workflow)). This typically involves importing data, reshaping and/or subsetting the data to get it into a format necessary for analysis, doing some preliminary descriptive statistics to explore general properties of the data, doing some inferential statistics to investigate trends in the data, and summarizing the results of the analysis. At various stages, visualizing will be help, either to explore the data further or to help communicate the results to others. A lot of the output of this process, we will also want to save for later, perhaps to include in a publication (like a figure or model summary), but maybe also to avoid repetition of difficult and time-consuming tasks (where we would, for example, save our cleaned up dataset).

<br>

```{r r-workflow, echo = FALSE, out.width = '60%', fig.cap = "Standard workflow in R"}

knitr::include_graphics("images/r-workflow.png")

```

<br>

Of course, this is only an idealized workflow and not necessarily one that will ever be realized in practice. It should, however, provide some indication of the general make-up of a complete statistical analysis in R.

### Load Data

```{r}

penguins <- read.csv("penguins.csv")

head(penguins)

```

### Do Grunt Work

Are observations of bill length missing for any penguins in this dataset? To answer this question, we can check for NA values.

```{r}

any(is.na(penguins$bill_length_mm))

```

<br>

And if we really need that information, we can exclude those penguins from our analysis.

```{r}

penguins <- subset(penguins, !is.na(bill_length_mm))

```

<br>

How many penguins are on each island?

```{r}

counts <- table(penguins$island)

counts

```

<br>

What does this distribution look like?

```{r, fig.width = 5}

barplot(counts)

```

<br>

What is the mean bill length for each species?

```{r}

aggregate(bill_length_mm ~ species, 
          FUN = mean,
          data = penguins)

```

<br>

And the standard deviation?

```{r}

aggregate(bill_length_mm ~ species, 
          FUN = sd,
          data = penguins)

```

<br>

How is bill length distributed across species?

```{r, fig.width = 5}

boxplot(bill_length_mm ~ species, 
        data = penguins,
        xlab = "Species",
        ylab = "Bill Length (mm)")

```

### Do Fun Stuff

```{r}

penguin_model <- lm(flipper_length_mm ~ bill_length_mm, data = penguins)

summary(penguin_model)

```

<br>

Estimate flipper length using `penguin_model`.

```{r}

est_flipper_length <- predict(penguin_model)

```

```{r}

obs_flipper_length <- penguins$flipper_length_mm

obs_bill_length <- penguins$bill_length_mm

```

<br>

Plot the estimated trend against the observed values:

```{r, fig.width = 5, fig.height = 5}

plot(obs_flipper_length ~ obs_bill_length,
     pch = 19,
     cex = 1.3,
     col = alpha("#949494", 0.4),
     xlab = "Bill Length (mm)",
     ylab = "Flipper Length (mm)")

lines(est_flipper_length ~ obs_bill_length, col = "#850000")

mtext(text = "Palmer Penguin Model",
      side = 3, 
      line = 0.3, 
      adj = 0, 
      cex = 1.5)

```

### Export Results

Save the cleaned data.

```{r, eval = FALSE}

write.csv(penguins, "penguins.csv", row.names = FALSE)

```

Save the linear model.

```{r, eval = FALSE}

save(penguin_model, file = "penguin_model.Rdata")

```

And that's it!

[Note: saving a figure in base R is a bit tricky, so we will leave that lesson for another time.]
